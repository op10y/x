!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("valtio/vanilla"),require("derive-valtio")):"function"==typeof define&&define.amd?define(["exports","valtio/vanilla","derive-valtio"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).valtioVanillaUtils={},t.valtioVanilla,t.deriveValtio)}(this,(function(t,e,n){"use strict";var r;function i(t,e,n,r){var i={configurable:!0,enumerable:!0};return i[t]=r,Object.defineProperty(e,n,i)}function a(){return a=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},a.apply(this,arguments)}var o=["enabled","name"],u=Symbol();var s,c=function t(n){if(s||(s=e.unstable_buildProxyFunction()[2]),"object"!=typeof(r=n)||null===r||s.has(n))return n;var r,i=Array.isArray(n)?[]:Object.create(Object.getPrototypeOf(n));return Reflect.ownKeys(n).forEach((function(e){i[e]=t(n[e])})),i};Object.defineProperty(t,"derive",{enumerable:!0,get:function(){return n.derive}}),Object.defineProperty(t,"underive",{enumerable:!0,get:function(){return n.underive}}),Object.defineProperty(t,"unstable_deriveSubscriptions",{enumerable:!0,get:function(){return n.unstable_deriveSubscriptions}}),t.addComputed=function(t,e,r){void 0===r&&(r=t);var i={};return Object.keys(e).forEach((function(n){i[n]=function(r){return e[n](r(t))}})),n.derive(i,{proxy:r})},t.devtools=function(t,n){"string"==typeof n&&(console.warn("string name option is deprecated, use { name }. https://github.com/pmndrs/valtio/pull/400"),n={name:n});var r,i=n||{},s=i.enabled,c=i.name,f=void 0===c?"":c,d=function(t,e){if(null==t)return{};var n,r,i={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(i,o);try{r=null!=s&&s&&window.__REDUX_DEVTOOLS_EXTENSION__}catch(t){}if(r){var l=!1,p=r.connect(a({name:f},d)),h=e.subscribe(t,(function(n){var r=n.filter((function(t){return t[0],t[1][0]!==u})).map((function(t){return t[0]+":"+t[1].map(String).join(".")})).join(", ");if(r)if(l)l=!1;else{var i=Object.assign({},e.snapshot(t));delete i[u],p.send({type:r,updatedAt:(new Date).toLocaleString()},i)}})),y=p.subscribe((function(n){var r,i;if("ACTION"===n.type&&n.payload)try{Object.assign(t,JSON.parse(n.payload))}catch(t){console.error("please dispatch a serializable value that JSON.parse() and proxy() support\n",t)}if("DISPATCH"===n.type&&n.state){var a,o;if("JUMP_TO_ACTION"===(null==(a=n.payload)?void 0:a.type)||"JUMP_TO_STATE"===(null==(o=n.payload)?void 0:o.type)){l=!0;var s=JSON.parse(n.state);Object.assign(t,s)}t[u]=n}else if("DISPATCH"===n.type&&"COMMIT"===(null==(r=n.payload)?void 0:r.type))p.init(e.snapshot(t));else if("DISPATCH"===n.type&&"IMPORT_STATE"===(null==(i=n.payload)?void 0:i.type)){var c,f,d=null==(c=n.payload.nextLiftedState)?void 0:c.actionsById,h=(null==(f=n.payload.nextLiftedState)?void 0:f.computedStates)||[];l=!0,h.forEach((function(n,r){var i=n.state,a=d[r]||"No action found";Object.assign(t,i),0===r?p.init(e.snapshot(t)):p.send(a,e.snapshot(t))}))}}));return p.init(e.snapshot(t)),function(){h(),null==y||y()}}},t.proxyMap=function(t){var n,r=e.proxy((i("get",n={data:Array.from(t||[]),has:function(t){return this.data.some((function(e){return e[0]===t}))},set:function(t,e){var n=this.data.find((function(e){return e[0]===t}));return n?n[1]=e:this.data.push([t,e]),this},get:function(t){var e;return null==(e=this.data.find((function(e){return e[0]===t})))?void 0:e[1]},delete:function(t){var e=this.data.findIndex((function(e){return e[0]===t}));return-1!==e&&(this.data.splice(e,1),!0)},clear:function(){this.data.splice(0)},get size(){return this.data.length},toJSON:function(){return new Map(this.data)},forEach:function(t){var e=this;this.data.forEach((function(n){t(n[1],n[0],e)}))},keys:function(){return this.data.map((function(t){return t[0]})).values()},values:function(){return this.data.map((function(t){return t[1]})).values()},entries:function(){return new Map(this.data).entries()}},Symbol.toStringTag,(function(){return"Map"})),n[Symbol.iterator]=function(){return this.entries()},n));return Object.defineProperties(r,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(r),r},t.proxySet=function(t){var n,r=e.proxy((i("get",n={data:Array.from(new Set(t)),has:function(t){return-1!==this.data.indexOf(t)},add:function(t){var n=!1;return"object"==typeof t&&null!==t&&(n=-1!==this.data.indexOf(e.proxy(t))),-1!==this.data.indexOf(t)||n||this.data.push(t),this},delete:function(t){var e=this.data.indexOf(t);return-1!==e&&(this.data.splice(e,1),!0)},clear:function(){this.data.splice(0)},get size(){return this.data.length},forEach:function(t){var e=this;this.data.forEach((function(n){t(n,n,e)}))}},Symbol.toStringTag,(function(){return"Set"})),n.toJSON=function(){return new Set(this.data)},n[Symbol.iterator]=function(){return this.data[Symbol.iterator]()},n.values=function(){return this.data.values()},n.keys=function(){return this.data.values()},n.entries=function(){return new Set(this.data).entries()},n));return Object.defineProperties(r,{data:{enumerable:!1},size:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(r),r},t.proxyWithComputed=function(t,n){Object.keys(n).forEach((function(i){if(Object.getOwnPropertyDescriptor(t,i))throw new Error("object property already defined");var a=n[i],o="function"==typeof a?{get:a}:a,u=o.get,s=o.set,c={get:function(){return u(e.snapshot(r))}};s&&(c.set=function(t){return s(r,t)}),Object.defineProperty(t,i,c)}));var r=e.proxy(t);return r},t.proxyWithHistory=function(t,n){void 0===n&&(n=!1);var r=e.proxy({value:t,history:e.ref({wip:void 0,snapshots:[],index:-1}),clone:c,canUndo:function(){return r.history.index>0},undo:function(){r.canUndo()&&(r.value=r.history.wip=r.clone(r.history.snapshots[--r.history.index]))},canRedo:function(){return r.history.index<r.history.snapshots.length-1},redo:function(){r.canRedo()&&(r.value=r.history.wip=r.clone(r.history.snapshots[++r.history.index]))},saveHistory:function(){r.history.snapshots.splice(r.history.index+1),r.history.snapshots.push(e.snapshot(r).value),++r.history.index},subscribe:function(){return e.subscribe(r,(function(t){t.every((function(t){return"value"===t[1][0]&&("set"!==t[0]||t[2]!==r.history.wip)}))&&r.saveHistory()}))}});return r.saveHistory(),n||r.subscribe(),r},t.subscribeKey=function(t,n,r,i){var a=t[n];return e.subscribe(t,(function(){var e=t[n];Object.is(a,e)||r(a=e)}),i)},t.watch=function(t,n){var i=!0,a=new Set,o=new Map,u=function(){i&&(i=!1,a.forEach((function(t){return t()})),a.clear(),o.forEach((function(t){return t()})),o.clear())};return r&&r.add(u),function u(){if(i){a.forEach((function(t){return t()})),a.clear();var s=new Set,c=r;r=a;try{var f=t((function(t){return s.add(t),t}));f&&a.add(f)}finally{r=c}o.forEach((function(t,e){s.has(e)?s.delete(e):(o.delete(e),t())})),s.forEach((function(t){var r=e.subscribe(t,u,null==n?void 0:n.sync);o.set(t,r)}))}}(),u}}));
